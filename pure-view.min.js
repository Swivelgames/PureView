var ViewContentItem=function(){var Constructor=function(node,value,handler){this._node=node;this.set(value),this._handler=handler};Constructor.prototype={_node:null,_value:null,_handler:null,set:function(val){this._value=val;this._node.nodeValue=val;if(this._handler instanceof Function)this._handler.call(this);return this.get()},get:function(){return this.toString()},toString:function(){return this._value}};return Constructor}();var ViewContentManager=function(){var Constructor=function(){this.__params={};var that=this;setInterval(function(){(function(){for(var x in this){if(!this.hasOwnProperty(x)||/^__/.test(x))continue;if(!this.__params.hasOwnProperty(x)){console.warn("Attempting to set content item "+x+" before initializing item with DOM.");delete this[x];continue}var param=this.__params[x],newValue=this[x];if(param.value!=newValue)param.controller.set(newValue)}}).call(that)},10)};Constructor.prototype={__params:null,
keys:function(){var ret=[];for(var x in this.__params)ret.push(x);return ret},newItem:function(node,name,val,isAttrChild){delete this[name];var that=this;this.__params[name]={"node":node,"value":val,"isAttrChild":isAttrChild?true:false,"controller":new ContentBind(node,val,function(){var thisParam=that.__params[name];if(thisParam.isAttrChild)thisParam.attributeValue=thisParam.attribute.nodeValue;thisParam.value=this.get()})};if(isAttrChild!==null){var thisParam=this.__params[name];thisParam.attribute=
isAttrChild;thisParam.attributeValue=isAttrChild.nodeValue;thisParam.__attrWatch=setInterval(function(){if(!thisParam.attribute||(!thisParam.attribute.nodeValue||!thisParam.attribute.ownerElement)){clearInterval(thisParam.__attrWatch);console.error("Parent attribute for content item `"+name+"` has been removed")}if(thisParam.attribute.nodeValue!=thisParam.attributeValue)console.error("DOM attribute modified outside of View; Content item bind lost for `"+name+"`")},100)}this[name]=val}};return Constructor}();var View=function(){var Constructor=function(DOM,Data){this.dom=DOM;this.data=Data||{};this.content=new ViewContentItems;this.render()};Constructor.prototype={dom:null,data:null,content:null,initView:function(){this.setContentUsingData();return true},render:function(){var dom=this.dom,contentNodes=this.getContentNodes(dom);for(var x=0;x<contentNodes.length;x++){var content=contentNodes[x];this.content.newItem(content.node,content.name,content.node.nodeValue,content.parentAttribute)}this.initView()},
getContentNodes:function(dom,arr,isAttribute){if(arr===void 0)arr=[];if(dom.nodeType==document.ELEMENT_NODE&&(dom.attributes&&dom.attributes.length>0)){var attrs=Array.prototype.slice.apply(dom.attributes);for(var x=0;x<attrs.length;x++)this.getContentNodes(attrs[x],arr,attrs[x])}if(dom.nodeType===document.TEXT_NODE)this.parseTextNode(dom,arr,isAttribute);else if(dom.childNodes&&dom.childNodes.length>0){var children=Array.prototype.slice.apply(dom.childNodes);for(var x=0;x<children.length;x++)this.getContentNodes(children[x],
arr,isAttribute)}return arr},parseTextNode:function(textNode,arr,isAttribute){if(textNode.nodeType!=document.TEXT_NODE)return arr;var reg=/\{\{\$[A-Z0-9_-]+\}\}/ig,val=textNode.nodeValue,split=val.split(reg),matches=val.match(reg),newNodes=[];for(var x=0;x<split.length;x++){if(x%2&&x>0){var match=matches[x-1],matchLen=match.length,matchName=match.substring(3,matchLen-2),matchNode=document.createTextNode(match);newNodes.push(matchNode);arr.push({name:matchName,node:matchNode,parentAttribute:isAttribute||
null})}newNodes.push(document.createTextNode(split[x]))}if(newNodes.length>0)this.__replaceNode(textNode,newNodes);return arr},setContentUsingData:function(){var data=this.data,content=this.content,keys=content.keys();for(var x=0;x<keys.length;x++){var key=keys[x];if(data[key])content[key]=data[key]}},__addAfter:function(node,newNode){node.parentNode.insertBefore(newNode,node.nextSibling)},__addBefore:function(node,newNode){node.parentNode.insertBefore(newNode,node)},__replaceNode:function(oldNode,
newNodes){oldNode.nodeValue=newNodes[0].nodeValue;var nextElem=oldNode;for(var x=1;x<newNodes.length;x++){this.__addAfter(nextElem,newNodes[x]);nextElem=newNodes[x]}return newNodes}};return Constructor}();
